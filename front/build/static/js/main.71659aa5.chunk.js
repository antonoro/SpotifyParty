(this.webpackJsonpspotifypartyfront=this.webpackJsonpspotifypartyfront||[]).push([[0],{42:function(e,t,a){e.exports=a.p+"static/media/record.b3d8db83.svg"},48:function(e,t,a){e.exports=a.p+"static/media/vynil.2840d63a.svg"},49:function(e,t,a){e.exports=a.p+"static/media/record.b3d8db83.svg"},52:function(e,t,a){e.exports=a(69)},57:function(e,t,a){},58:function(e,t,a){},64:function(e,t,a){},65:function(e,t,a){},66:function(e,t,a){},67:function(e,t,a){},68:function(e,t,a){},69:function(e,t,a){"use strict";a.r(t);var s=a(0),n=a.n(s),l=a(19),o=a.n(l),r=(a(57),a(10)),i=a(11),c=a(14),u=a(13),p=a(77),m=a(79),g=a(76);a(58),window.location.hash.substring(1).split("&").reduce((function(e,t){if(t){var a=t.split("=");e[a[0]]=decodeURIComponent(a[1])}return e}),{});window.location.hash="";a(59);var d=a(42),h=a.n(d),y=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(r.a)(this,a),(s=t.call(this)).handleScanDeviceClick=function(){s.props.getDevicesID()},s.state={user:"",userid:null,devicename:null,deviceactive:!1},s}return Object(i.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){this.props.user!==this.state.user&&this.setState({user:this.props.user}),this.state.devicename!==this.props.devicename&&null!==this.props.devicename&&this.setState({devicename:this.props.devicename,deviceactive:"".concat(this.props.deviceactive)})}},{key:"render",value:function(){return n.a.createElement(p.a,{className:"topheader",expand:"lg"},n.a.createElement(p.a.Brand,{className:"brandLogo",href:"/"},n.a.createElement("img",{className:"logo",alt:"logo",src:h.a})),n.a.createElement(p.a.Toggle,{bg:"light","aria-controls":"basic-navbar-nav"}),n.a.createElement(p.a.Collapse,{bg:"light",id:"basic-navbar-nav"},n.a.createElement(m.a,{className:"mr-auto"}),""===this.state.user?n.a.createElement(m.a,{className:"ml-auto logintag"},n.a.createElement(m.a.Link,{className:"topheader unique white",href:"/login/".concat(this.state.userid)},"Login with Spotify")):n.a.createElement(m.a,{bg:"light",className:"ml-auto"},n.a.createElement(g.a,{alignRight:!0,className:"myaccountTag",title:"My Account",id:"dropdown-menu-align-right"},n.a.createElement(g.a.Item,{className:"white"},"Hello, ",this.state.user),null===this.state.devicename?n.a.createElement("div",{className:"text-center"},n.a.createElement(g.a.Item,{className:"white"},"Device name: [No active device]"),n.a.createElement("button",{onClick:this.handleScanDeviceClick,className:"btn btn-success "},"Scan devices")):n.a.createElement(g.a.Item,{className:"white"},"Device name: ",this.state.devicename),n.a.createElement(g.a.Divider,null),n.a.createElement(g.a.Item,{className:"white",href:"/"},"Log out")))))}}]),a}(n.a.Component),f=a(35),v=(a(64),a(78)),E=a(80),b=a(75),S=a(34),N=a(81),k=a(47),T=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(r.a)(this,a),(s=t.call(this,e)).handleSelectedPlaylist=function(e){console.log("Selected playlist in MyGroups: ","".concat(e[0].name," from group: ").concat(e[1])),s.props.getplaylist(e[0],e[1])},s.handleSelectedGroup=function(e){console.log("Active group is: ",e.target.getAttribute("value")),s.props.getGroup(e.target.getAttribute("value"))},s.handleInputChange=function(e){s.setState(Object(f.a)({},e.target.name,[e.target.value]))},s.handleAddPlaylistSubmit=function(e){e.preventDefault(),""!==e.target.newPlaylist.value&&fetch("/createplaylist",{method:"POST",body:JSON.stringify({newplaylist:"".concat(s.state.newPlaylist),relatedgroup:"".concat(e.target.newPlaylistGroup.value)}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("addplaylist response:",e),null!==e&&(s.setState({newPlaylist:"",newPlaylistGroup:"",getgroups:!0}),console.log(s.state.newPlaylist))}))},s.handleAddGroupSubmit=function(e){if(e.preventDefault(),""!==e.target.newGroup.value){var t=s.state.newGroup;fetch("/creategroup",{method:"POST",body:JSON.stringify({newgroup:"".concat(s.state.newGroup),userid:s.state.userID}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){null!==e&&(s.setState({newGroup:"",getgroups:!0}),fetch("/creategroupmessages",{method:"POST",body:JSON.stringify({group:"".concat(t)}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){null!==e&&console.log("Group chatarchive created")})))}))}},s.handleAddMemberSubmit=function(e){e.preventDefault(),""!==e.target.newMember.value&&fetch("/addmember",{method:"POST",body:JSON.stringify({newMember:"".concat(s.state.newMember),relatedgroup:"".concat(e.target.newMemberGroup.value)}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){null!==e&&s.setState({newMember:"",newMemberGroup:"",getgroups:!0})}))},s.state={user:"",userID:null,loggedIn:!1,getgroups:!1,groups:null,newPlaylist:"",newPlaylistGroup:"",newGroup:"",newMember:"",newMemberGroup:"",selectedGroup:null,updatedPlaylist:null},s}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(){var e=this;if(this.props.user!==this.state.user&&""!==this.props.user&&this.state.userID!==this.props.userid&&this.setState({user:this.props.user,loggedIn:!0,getgroups:!0,userID:this.props.userid}),this.state.selectedGroup!==this.props.selectedGroup&&this.setState({selectedGroup:this.props.selectedGroup}),null!==this.state.groups&&null!==this.state.selectedGroup&&this.props.playlistToMyGroups!==this.state.updatedPlaylist){var t=this.state.groups;t.map((function(a,s){a.playlists.length&&a.groupname===e.state.selectedGroup&&a.playlists.map((function(a,n){if(a.name===e.props.playlistToMyGroups.name&&(console.log("Old tracklist:",a.tracklist),console.log("to update with:",e.props.playlistToMyGroups.tracklist),a.tracklist!==e.props.playlistToMyGroups.tracklist)){var l=t;l[s].playlists[n].tracklist=e.props.playlistToMyGroups.tracklist,e.setState({groups:l,updatedPlaylist:e.props.playlistToMyGroups})}}))}))}!0===this.state.loggedIn&&!0===this.state.getgroups&&(console.log("Actual groups are:",this.state.groups),this.getAllgroups())}},{key:"getAllgroups",value:function(){var e=this;fetch("/getallgroups",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:this.state.userID})}).then((function(t){return t.json().then((function(t){console.log("Fetch groups : ",t),e.setState({groups:t,getgroups:!1})}))}))}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"fullsize"},null!==this.state.user?n.a.createElement("div",{className:"fullsize"},n.a.createElement(v.a,null,n.a.createElement(v.a.Toggle,{as:E.a.Header,eventKey:1},"Create Group"),n.a.createElement(v.a.Collapse,{eventKey:1},n.a.createElement(E.a.Body,null,n.a.createElement("form",{onSubmit:this.handleAddGroupSubmit},n.a.createElement(b.a,null,n.a.createElement(b.a.Group,null,n.a.createElement(b.a.Control,{className:"input",onChange:this.handleInputChange,name:"newGroup",type:"text",placeholder:"Enter name",value:this.state.newGroup})),n.a.createElement(S.a,{className:"btnAddPlaylist",variant:"success",type:"submit"},"Create")))))),null!==this.state.groups?n.a.createElement(v.a,{defaultActiveKey:"0"},this.state.groups.map((function(t,a){return n.a.createElement(E.a,null,n.a.createElement(v.a.Toggle,{as:"button",className:"btn btn-secondary",onClick:e.handleSelectedGroup,value:t.groupname,eventKey:a},t.groupname),n.a.createElement(v.a.Collapse,{eventKey:a},n.a.createElement(E.a.Body,null,n.a.createElement("h4",null,"Members"),n.a.createElement("ul",{id:"MemberList"},t.members.map((function(e,t){var a=e.split("@")[0];return n.a.createElement("h6",null,a)}))),n.a.createElement(v.a,null,n.a.createElement(v.a.Toggle,{as:S.a,eventKey:3},"Add Member"),n.a.createElement(v.a.Collapse,{eventKey:3},n.a.createElement(E.a.Body,null,n.a.createElement("form",{onSubmit:e.handleAddMemberSubmit},n.a.createElement(b.a,{role:"form"},n.a.createElement(b.a.Group,null,n.a.createElement(b.a.Control,{name:"newMemberGroup",type:"hidden",value:e.state.groups[a].groupname}),n.a.createElement(b.a.Control,{onChange:e.handleInputChange,name:"newMember",type:"email",placeholder:"Enter email",value:e.state.newMember}),n.a.createElement(S.a,{className:"btnAddPlaylist",variant:"success",type:"submit"},"Add"))))))),n.a.createElement("h4",{className:"labelPlaylist"},"Playlists"),n.a.createElement("div",{id:"fixedspacing"},n.a.createElement("p",null)),n.a.createElement(N.a,{type:"radio",name:"playlists",vertical:!0,onChange:e.handleSelectedPlaylist},t.playlists.map((function(t,s){return n.a.createElement(k.a,{id:"playlistbtns",value:[e.state.groups[a].playlists[s],e.state.groups[a].groupname]},t.name)}))),n.a.createElement("div",{id:"fixedspacing"},n.a.createElement("p",null)),n.a.createElement(v.a,null,n.a.createElement(v.a.Toggle,{as:S.a,eventKey:2},"Create Playlist"),n.a.createElement(v.a.Collapse,{eventKey:2},n.a.createElement(E.a.Body,null,n.a.createElement("form",{onSubmit:e.handleAddPlaylistSubmit},n.a.createElement(b.a,{role:"form"},n.a.createElement(b.a.Group,null,n.a.createElement(b.a.Control,{name:"newPlaylistGroup",type:"hidden",value:e.state.groups[a].groupname}),n.a.createElement(b.a.Control,{onChange:e.handleInputChange,name:"newPlaylist",type:"text",placeholder:"Enter name",value:e.state.newPlaylist}),n.a.createElement(S.a,{className:"btnAddPlaylist",variant:"success",type:"submit"},"Create"))))))))))}))):n.a.createElement("div",null)):n.a.createElement("h4",null,"Not logged in"))}}]),a}(n.a.Component),D=a(26);a(65);var P=function(e){var t=Object(s.useState)(null),a=Object(D.a)(t,2),l=a[0],o=a[1],r=Object(s.useState)(""),i=Object(D.a)(r,2),c=i[0],u=i[1],p=Object(s.useState)([]),m=Object(D.a)(p,2),g=m[0],d=m[1],h=Object(s.useState)(null),y=Object(D.a)(h,2),f=(y[0],y[1]);return Object(s.useEffect)((function(){""!==e.group&&(!function(t){var a=window.location.origin.replace(/^http/,"ws"),s=new WebSocket(a);console.log("Host is",a),s.onopen=function(){console.log("WS client connected"),s.onmessage=function(t){console.log("WS client set message:",JSON.parse(t.data)),JSON.parse(t.data).map((function(t,a){t.groupname===e.group&&d(t.messages)}))}}}(e.group),u(e.author),o(e.group),d([]))}),[e.group]),Object(s.useEffect)((function(){fetch("/allgroupmessages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:e.group})}).then((function(e){return e.json()})).then((function(e){e.success?(console.log("Setting messageCollection",e.data.messages),d(e.data.messages)):console.log("No group registered")})).catch((function(e){return f(e)}))}),[l]),n.a.createElement("div",{className:"chat"},""===e.group?n.a.createElement("div",null,n.a.createElement("h2",null,"Group chat"),n.a.createElement("h2",null,"[No group selected]")):n.a.createElement("div",null,n.a.createElement("h2",null,"Group chat: ",l),n.a.createElement("div",{id:"chatbox",className:"row justify-content-center p-3"},n.a.createElement("table",{className:"tablechat"},n.a.createElement("thead",null,n.a.createElement("th",{className:"user"}),n.a.createElement("th",{className:"message"})),n.a.createElement("tbody",null,g.map((function(e,t){return n.a.createElement("tr",null,n.a.createElement("td",{className:"user"},e[1]," said: "),n.a.createElement("td",{className:"message"},e[0]))}))))),n.a.createElement("div",{className:"row justify-content-center"},n.a.createElement("form",{onSubmit:function(e){e.preventDefault();var t=e.target[0].value,a=e.target[1].value,s=e.target[2].value;fetch("/sendchatmessage",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({group:t,author:a,writtenmessage:s})}).then((function(e){return e.json().then((function(e){console.log("Done.",e)}))}))},class:"form-inline justify-content-left p-3"},n.a.createElement("div",{class:"form-group mb-2"},n.a.createElement("input",{className:"form-control",name:"group",value:l,type:"hidden"}),n.a.createElement("input",{className:"form-control",name:"author",value:c,type:"hidden"}),n.a.createElement("input",{className:"form-control",name:"writtenMessage",type:"text",placeholder:"Write a message...",required:!0})),n.a.createElement("button",{className:"btn btn-success mb-2",type:"submit"},"Send")))))},I=(a(66),a(74)),w=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(r.a)(this,a),(s=t.call(this,e)).getTrackInfos=function(e){fetch("/gettracksinfo",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracks:e,userid:s.state.userID})}).then((function(e){return e.json().then((function(e){console.log("Fetched tracks info:",e);var t=[];e.map((function(e,a){return t[a]=[e.name,e.artists[0].name,e.album.name,"".concat(Math.floor(e.duration_ms/6e4).toFixed(0),":").concat((e.duration_ms/1e3%60).toFixed(0)),e.uri]})),console.log("Tracks:",t),s.setState({tracklist:t})}))}))},s.handleInputChange=function(e){s.setState(Object(f.a)({},e.target.name,[e.target.value]))},s.searchSubmit=function(e){e.preventDefault(),""!==e.target.searchedTrack.value&&fetch("/searchtracks",{method:"POST",body:JSON.stringify({searchedTrack:"".concat(s.state.searchedTrack),userid:s.state.userID}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(null!==e){console.log("Returned tracks:",e.items);var t=[];e.items.map((function(e,a){return t[a]=[e.name,e.artists[0].name,e.album.name,e.uri]})),s.setState({foundTracks:t,searchedTrack:""}),console.log("tracks: ",s.state.foundTracks)}}))},s.addSongtoMongo=function(e){console.log(e.target.value);var t=e.target.value.split(":");fetch("/addtracktoplaylist",{method:"POST",body:JSON.stringify({uriTrack:"".concat(t[2]),playlist:"".concat(s.state.playlistname),group:"".concat(s.state.group),userid:s.state.userID}),headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){console.log("Playlists",e),s.setState({foundTracks:[]}),s.props.getUpdatedPlaylist(e,s.state.group)}))},s.state={group:"",userID:null,playlist:null,playlistname:null,tracklist:[["",""]],nextup:0,searchedTrack:"",foundTracks:[]},s}return Object(i.a)(a,[{key:"componentDidUpdate",value:function(){if(this.state.playlist!==this.props.playlist&&null!==this.props.playlist&&this.props.groups!==this.state.group){var e=[];this.props.playlist.tracklist.map((function(t,a){return e[a]=t})),this.setState({playlist:this.props.playlist,playlistname:this.props.playlist.name,group:this.props.group}),e.length>0?this.getTrackInfos(e):this.setState({tracklist:[["",""]]})}""!==this.props.user&&this.state.userID!==this.props.userid&&this.setState({userID:this.props.userid}),this.state.nextup!==this.props.nextup&&(this.props.nextup<this.state.tracklist.length&&this.setState({nextup:this.props.nextup}),0===this.state.tracklist.length&&this.setState({nextup:0}))}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"row nextupAddsong",style:{}},n.a.createElement("div",{className:"col-6"},null!==this.state.playlist?n.a.createElement("div",{className:"nextup"},n.a.createElement("h3",{className:"bigF"},"Next up: ",this.state.tracklist[this.state.nextup][0]," - ",this.state.tracklist[this.state.nextup][1]),n.a.createElement("label",null,"Playlist name: ",this.state.playlistname," Group: ",this.state.group),n.a.createElement(I.a,{striped:!0,border:!0},n.a.createElement("thead",{className:"nextup"},n.a.createElement("th",null,"#"),n.a.createElement("th",null,"Song"),n.a.createElement("th",null,"Artist"),n.a.createElement("th",null,"Album"),n.a.createElement("th",null,"Duration")),n.a.createElement("tbody",null,this.state.tracklist.map((function(e,t){return n.a.createElement("tr",{className:"nextup"},n.a.createElement("td",null,t+1),n.a.createElement("td",null,e[0]),n.a.createElement("td",null,e[1]),n.a.createElement("td",null,e[2]),n.a.createElement("td",null,e[3]))}))))):n.a.createElement("h2",{className:"nextup"},"[No playlist selected]")),n.a.createElement("div",{className:"col-6"},n.a.createElement("h2",{div:!0,className:"nextup"},"Add song to playlist"),null!==this.state.playlist?n.a.createElement("div",null,n.a.createElement("form",{class:"form-inline justify-content-center",onSubmit:this.searchSubmit},n.a.createElement("div",{class:"form-group mb-2 "},n.a.createElement("input",{onChange:this.handleInputChange,className:"form-control",name:"searchedTrack",value:this.state.searchedTrack,type:"text",placeholder:"Search song..."})),n.a.createElement("button",{className:"btn btn-success mb-2",type:"submit"},"Search")),n.a.createElement(I.a,{striped:!0,border:!0,className:"nextup"},n.a.createElement("thead",null,n.a.createElement("th",null,"Song"),n.a.createElement("th",null,"Artist"),n.a.createElement("th",null,"Album"),n.a.createElement("th",null,"Select")),this.state.foundTracks.length>0?n.a.createElement("tbody",null,this.state.foundTracks.map((function(t,a){return n.a.createElement("tr",null,n.a.createElement("td",null,t[0]),n.a.createElement("td",null,t[1]),n.a.createElement("td",null,t[2]),n.a.createElement("td",null,n.a.createElement("button",{onClick:e.addSongtoMongo.bind(e),value:t[3],className:"btn btn-success"},"Add")))}))):n.a.createElement("tbody",null))):n.a.createElement("div",null)))}}]),a}(n.a.Component),C=(a(67),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(r.a)(this,a),(s=t.call(this)).getMusicInfo=function(){console.log("Fetching playback info..."),fetch("/getplayback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:s.state.userID})}).then((function(e){return e.json().then((function(e){console.log("res is:",e),null!==e&&void 0!==e&&(console.log("Fetched!"),s.setState({item:e.item,refreshToggled:!1,playback:e.is_playing}))}))}))},s.playpausePlayback=function(e){console.log("Playing/pausing playback..."),fetch("/"+e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:s.state.userID})}).then((function(e){return e.json().then((function(e){null!==e&&(console.log("Done!: ",e),s.setState({playbackCommandtrigger:!1}))}))}))},s.playSong=function(e){fetch("/playsong",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uri:"".concat(e),deviceID:"".concat(s.state.deviceID),userid:s.state.userID})}).then((function(e){return e.json().then((function(e){console.log(e),s.state.iteratorPlaylist<s.state.playlistDisplay.tracklist.length?(console.log("Waiting for spotify to change song..."),setTimeout((function(){s.state.changePlaybackTriggerNext?s.setState({refreshToggled:!0,changePlaybackTriggerNext:!1,iteratorPlaylist:s.state.iteratorPlaylist+1}):s.state.changePlaybackTriggerPrevious&&s.setState({refreshToggled:!0,changePlaybackTriggerPrevious:!1,iteratorPlaylist:s.state.iteratorPlaylist+1})}),1e3)):setTimeout((function(){s.setState({refreshToggled:!0,changePlaybackTriggerNext:!1,iteratorPlaylist:0}),console.log("Reset iterator: ",s.state.iteratorPlaylist)}),1e3)}))}))},s.changePlaybackNext=function(){console.log("Changing playback..."),fetch("/next").then((function(e){return e.json().then((function(e){null!==e?(console.log("Fetched!: ",e),s.setState({changePlaybackTriggerNext:!1}),console.log("Waiting for spotify to change song..."),setTimeout((function(){s.setState({refreshToggled:!0})}),1e3)):alert("Error from spotify")}))}))},s.changePlaybackPrevious=function(e){console.log("Changing playback..."),fetch("/previous").then((function(e){return e.json().then((function(e){null!==e?(console.log("Fetched!: ",e),s.setState({changePlaybackTriggerPrevious:!1}),console.log("Waiting for spotify to change song..."),setTimeout((function(){s.setState({refreshToggled:!0})}),1e3)):alert("Error from spotify")}))}))},s.getSelectedPlaylist=function(e,t){console.log("Got selected playlist in dashboard: ","".concat(e.tracklist," from group: ").concat(t)),s.setState({playlistDisplay:e,iteratorPlaylist:0})},s.getSelectedGroup=function(e){console.log("Got selected group in dashboard: ",e),s.setState({group:e})},s.addedSongtoPlaylist=function(e,t){console.log("Got updated playlist in dashboard: ","".concat(e," from group: ").concat(t)),s.setState({playlistDisplay:e,playlistToMyGroups:e,group:t})},s.state={user:"",deviceID:null,userID:null,loggedIn:!1,item:null,refreshToggled:!1,playbackCommandtrigger:!1,playListCommandtrigger:!1,changePlaybackTriggerNext:!1,changePlaybackTriggerPrevious:!1,changePlayback:null,playback:null,playlistDisplay:null,playlistToMyGroups:null,iteratorPlaylist:0,group:""},s}return Object(i.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){if(null!==this.state.userID&&this.props.user!==this.state.user&&""!==this.props.user&&this.props.deviceID!==this.state.deviceID&&null!==this.props.deviceID&&(this.setState({user:this.props.user,loggedIn:!0,deviceID:this.props.deviceID}),this.getMusicInfo()),null!==this.props.userid&&this.props.userid!==this.state.userID&&this.setState({userID:this.props.userid}),this.state.refreshToggled&&(console.log("Refreshed"),this.getMusicInfo()),this.state.playbackCommandtrigger&&(console.log("Triggered Play/pause"),!0===this.state.playback?(console.log("play"),this.playpausePlayback("play")):(console.log("pause"),this.playpausePlayback("pause"))),this.state.changePlaybackTriggerNext){var e=this.state.iteratorPlaylist;console.log("size:",this.state.playlistDisplay.tracklist.length),console.log("iterator: ",e),console.log("next song: ",this.state.playlistDisplay.tracklist[e]),this.playSong(this.state.playlistDisplay.tracklist[e])}if(this.state.changePlaybackTriggerPrevious){if(this.state.iteratorPlaylist>0)e=this.state.iteratorPlaylist-1;else e=0;console.log("previous song: ",this.state.playlistDisplay.tracklist[e]),this.playSong(this.state.playlistDisplay.tracklist[e])}}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{id:"mainrow",className:"row"},n.a.createElement("div",{id:"mygroups",className:"col-2 "},n.a.createElement("div",{className:"row justify-content-center groupR"},n.a.createElement("h2",{className:"titleGroup"},"My groups"),n.a.createElement(T,{userid:this.state.userID,user:this.state.user,getplaylist:this.getSelectedPlaylist,getGroup:this.getSelectedGroup,selectedGroup:this.state.group,playlistToMyGroups:this.state.playlistToMyGroups}))),n.a.createElement("div",{className:"col-7"},n.a.createElement("div",{className:"row nowplaying "},n.a.createElement("div",{className:"col-6"},null===this.state.item||void 0===this.state.item?n.a.createElement("div",null,n.a.createElement("h2",{className:"nowP"},"Now Playing: [Nothing is playing]"),""!==this.state.user?n.a.createElement("button",{className:"btn btn-warning",onClick:function(){return e.setState({refreshToggled:!0})}},"Refresh"):n.a.createElement("div",null),null!==this.state.playlistDisplay?n.a.createElement("button",{className:"btn btn-primary",onClick:function(){return e.setState({changePlaybackTriggerNext:!0})}},"Play Next"):n.a.createElement("div",null)):n.a.createElement("div",null,n.a.createElement("h2",{className:"nowP"},"Now Playing:"),n.a.createElement("h5",{className:"songName"},this.state.item.name),n.a.createElement("h6",{className:"artistName"},"Artist: ",this.state.item.artists[0].name),n.a.createElement("h6",{className:"albumName"},"Album: ",this.state.item.album.name),n.a.createElement("button",{className:"btn btn-warning res",onClick:function(){return e.setState({refreshToggled:!0})}},"Refresh"),this.state.playback?n.a.createElement("button",{className:"btn btn-danger res",onClick:function(){return e.setState({playbackCommandtrigger:!0,playback:!1})}},"Pause"):n.a.createElement("button",{className:"btn btn-success res",onClick:function(){return e.setState({playbackCommandtrigger:!0,playback:!0})}},"Play"),null!==this.state.playlistDisplay&&this.state.iteratorPlaylist<this.state.playlistDisplay.tracklist.length?n.a.createElement("button",{className:"btn btn-primary res",onClick:function(){return e.setState({changePlaybackTriggerNext:!0})}},"Next"):n.a.createElement("button",{className:"btn btn-primary res",disabled:!0},"Next"))),n.a.createElement("div",{className:"col-6"},null===this.state.item||void 0===this.state.item?n.a.createElement("h2",null):n.a.createElement("div",null,n.a.createElement("img",{src:"".concat(this.state.item.album.images[1].url),alt:"Cover"})))),n.a.createElement("div",null,n.a.createElement(w,{userid:this.state.userID,playlist:this.state.playlistDisplay,getUpdatedPlaylist:this.addedSongtoPlaylist,group:this.state.group,nextup:this.state.iteratorPlaylist}))),n.a.createElement("div",{id:"chat",className:"col-3"},n.a.createElement(P,{group:this.state.group,author:this.state.user})))}}]),a}(n.a.Component)),O=(a(68),a(48)),j=a.n(O),G=a(49),x=a.n(G),M=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).getDeviceID=function(){console.log("Get DeviceID requested"),fetch("/mydevices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.state.userID})}).then((function(e){return e.json().then((function(e){0===e.length?alert("No active computer devices"):console.log("Devices found: ",e)}))}))},e.getID=function(t){e.setState({userID:t}),console.log("App got client id:",e.state.userID)},e.state={loggedin:!1,sessionExists:!1,userState:"",deviceID:null,devicename:null,deviceactive:!1,userID:null,LandinguserID:null,getUserToggled:!1},e}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;if(!this.state.sessionExists){var t=sessionStorage.getItem("useridsession");console.log("SESSION ID:",t)}null===this.state.userID&&null===sessionStorage.getItem("useridsession")&&(console.log("Requesting client id..."),fetch("/authorize").then((function(t){return t.json().then((function(t){e.setState({userID:t.userid}),console.log("Landing on page with id:",e.state.userID),e.getID(t.userid)}))}))),!0!==this.state.loggedin&&(console.log("fetching getUser on mount..."),fetch("/getUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:this.state.userID})}).then((function(t){return t.json().then((function(t){200===t.statusCode?t.displayname!==e.state.userState&&(console.log("Fetched!",t.displayname),e.setState({userState:t.displayname,loggedin:!0})):(console.log("Error code: ",t.statusCode),"tryagain"===t.statusCode&&e.setState({getUserToggled:!0}))}))})).catch((function(e){console.log("Error with GetUser")})))}},{key:"componentDidUpdate",value:function(){var e=this;if(!this.state.sessionExists){var t=sessionStorage.getItem("useridsession");null===t?console.log("No session user ID saved."):(console.log("Session id saved:",t),this.setState({userID:t,loggedin:!0,getUserToggled:!1,sessionExists:!0}))}this.state.getUserToggled&&setTimeout((function(){console.log("fetching getUser..."),fetch("/getUser",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:e.state.userID})}).then((function(t){return t.json().then((function(t){if(200===t.statusCode){if(t.displayname!==e.state.userState){console.log("Fetched!:",t.displayname);sessionStorage.getItem("useridsession");sessionStorage.setItem("useridsession",e.state.userID),console.log("SESSION ID:",sessionStorage.getItem("useridsession")),e.setState({userState:t.displayname,loggedin:!0,getUserToggled:!1,sessionExists:!0})}}else console.log("Error code: ",t.statusCode),"tryagain"===t.statusCode&&e.setState({getUserToggled:!0})}))})).catch((function(e){console.log("Error with GetUser")}))}),500),null===this.state.deviceID&&!0===this.state.loggedin&&(console.log("user id:",this.state.userID),console.log("Device id:",this.state.deviceid),console.log("Logged in:",this.state.loggedin),fetch("/mydevices",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userid:this.state.userID})}).then((function(t){return t.json().then((function(t){0===t.length?alert("No listening is activated. Open your web browser at open.spotify.com, active your device (play/pause) and reload page."):(console.log("Device found: ",t[0]),t[0].deviceid!==e.state.deviceID&&e.setState({deviceID:t[0].deviceid,devicename:t[0].devicename,deviceactive:t[0].deviceactive}))}))})))}},{key:"render",value:function(){return n.a.createElement("div",{className:"App"},this.state.loggedin?n.a.createElement("div",null,n.a.createElement(y,{user:this.state.userState,getID:this.getID,devicename:this.state.devicename,deviceactive:this.state.deviceactive,getDevicesID:this.getDeviceID}),n.a.createElement("div",{className:"container-fluid"},n.a.createElement(C,{user:this.state.userState,deviceID:this.state.deviceID,userid:this.state.userID}))):n.a.createElement("div",{className:"Plus"},n.a.createElement("header",{className:"App-header"},n.a.createElement("button",{className:"Home"}),n.a.createElement("div",{className:""},n.a.createElement("a",{className:"Login",href:"/login/".concat(this.state.userID)},"Log In"),n.a.createElement("a",{href:"https://www.spotify.com/us/",className:"Register"},"Register Now!"))),n.a.createElement("div",{className:"MiddleTitle"},n.a.createElement("h2",{className:"Black"},"Be the life of the party!"),n.a.createElement("h1",{className:"Title"},"SHARING MUSIC"),n.a.createElement("h1",{className:"Title"},"NEVER FELT SO ",n.a.createElement("span",{className:"Outline"},"GOOD")),n.a.createElement("img",{alt:"Vynil",src:j.a,className:"Vynil"}),n.a.createElement("img",{alt:"Record",src:x.a,className:"Record"}),n.a.createElement("a",{href:"/login/".concat(this.state.userID),className:"Button"},n.a.createElement("svg",null,n.a.createElement("g",null,n.a.createElement("line",{x2:"227.62",y1:"31.28",y2:"31.28"}),n.a.createElement("polyline",{points:"222.62 25.78 228.12 31.28 222.62 36.78"}),n.a.createElement("circle",{cx:"224.67",cy:"30.94",r:"30.5",transform:"rotate(180 224.67 30.94) scale(1, -1) translate(0, -61)"}))),n.a.createElement("font",null,"Enter the Sound"))),n.a.createElement("footer",{className:"Foot"},n.a.createElement("p",{className:"Copyright"},"\xa9 Antoine & Juan"),n.a.createElement("button",{className:"About"},"ABOUT"))))}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[52,1,2]]]);
//# sourceMappingURL=main.71659aa5.chunk.js.map